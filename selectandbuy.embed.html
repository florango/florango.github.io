<div id="products">
    <div id="enter-zip">
        <h3>We need to make sure you're within our Delivery Network</h3> Please enter the ZipCode of the intended Delivery Address so we can make sure we're able to get to you!
        <input id="zip" type="text" name="zip"/><a href="#" id="check-zip">Go!</a>
    </div>
    <div id="choose-product">
        <a href="https://subscriptions.zoho.com/subscribe/09dd718b7495e52928b10be395c1ecd26a2bba0f6b053217ad482bf477cf719e/weeklyhome">Every Week</a>
            <a href="https://subscriptions.zoho.com/subscribe/09dd718b7495e52928b10be395c1ecd26a2bba0f6b053217ad482bf477cf719e/biweeklyhome">Every 2 Weeks</a>
            <a href="https://subscriptions.zoho.com/subscribe/09dd718b7495e52928b10be395c1ecd26a2bba0f6b053217ad482bf477cf719e/monthlyhome">Once a Month</a>
        

    </div>
    <div id="available-soon">
        Name <input id="Name"/>
        Email <input id="Email"/>
        Phone <input id="Phone"/>
        <input id="Zip" type="hidden"/>
        <a href="#" id="interested">Submit</a>
    </div>
    <div id="thanks-for-info">
        Thanks for letting us know you're interested! We're growing our delivery area every day, and will be in touch when we can provide you with fresh flowers!
    </div>
</div>
<script>
    let enterZipEl = document.querySelector('#enter-zip');
    let checkZipEl = document.querySelector('#check-zip');
    let chooseProductEl = document.querySelector('#choose-product');
    let availableSoonEl = document.querySelector('#available-soon');
    let thanksForInfoEl = document.querySelector('#thanks-for-info');
    let interestedButtonEl = document.querySelector('#interested');
    let userZip;
    checkZipEl.onclick = (event) => {
        event.preventDefault();
        userZip = document.querySelector('#zip').value;        
        let zipValid = false;
        fetch('https://adobeioruntime.net/api/v1/web/helix/helix-services/data-embed@v1/https://docs.google.com/spreadsheets/d/1F-lRwit5ZvIXCMaHpsPPWuWyyK4yMnJiLlHKbQdXd4Y/edit#gid=0')        
        .then(response => response.json())
        .then(data => {
            data.map(({Zip}) => {
                if(Zip == userZip) {
                    zipValid = true;
                }
            })
            if(zipValid) {                
                enterZipEl.style.display = 'none';
                chooseProductEl.style.display = 'block';
            } else {
                document.getElementById('Zip').value = userZip;
                enterZipEl.style.display = 'none';
                availableSoonEl.style.display = 'block';
            }
        });
        
        interestedButtonEl.onclick = (event) => {
            event.preventDefault();
            appendLog();
        }   
        
    }

    function appendLog() {                
        let qs=`?`
        document.querySelectorAll('#available-soon input').forEach((e) => {
            qs += `${e.id}=${encodeURIComponent(e.value)}&`            
        })
        fetch(`https://script.google.com/macros/s/AKfycbyfnm0rPtqgMza-ttp-h6ZDutQA3fxAIK6Uc79Dgkw4aEGjifGl/exec${qs}`)
            .then((response) => {
                return response.json();
            })
            .then((data) => {
                let {result} = data
                if(result != 'success') {
                    console.log(data);
                }
                availableSoonEl.style.display = 'none';
                thanksForInfoEl.style.display = 'block';
            });            
        }
</script>

<style>
    #choose-product {
        display: none;
    }

    #available-soon {
        display: none;
    }

    #thanks-for-info {
        display: none;
    }

    #products a {
        display: inline-block;
        border-radius: 10px;
        background-color: #879988;
        color: #EDE6D2;
        text-decoration: none;
        padding: 12px 20px 10px 20px;    
        font-weight: 400;
        outline-style: none;
        outline-color: #879988;
        outline-width: 4px;
        text-transform: uppercase;        
    }

    #products input {
        display: inline-block;
        
    }
</style>