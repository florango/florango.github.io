{"version":3,"sources":["scripts.js"],"names":["loadInclude","$block","blockName","fetch","resp","text","innerHTML","hydrate","createTag","name","attrs","el","document","createElement","Object","entries","key","value","setAttribute","wrapSections","element","querySelectorAll","forEach","$div","childNodes","length","firstElementChild","remove","id","$wrapper","parentNode","appendChild","decorateFullWidthImage","$img","$section","closest","children","tagName","startsWith","classList","add","loadCSS","href","querySelector","link","onload","onerror","head","loadBlocks","getAttribute","then","mod","err","console","log","decorateBlocks","classes","Array","from","values","replace","blocksWithOptions","b","options","substring","split","filter","opt","loadHeader","decoratePage","complete","loadLater","addEventListener","body"],"mappings":"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","sourcesContent":["export async function loadInclude($block, blockName) {\n  const resp = await fetch(`/blocks/${blockName}/${blockName}.html`);\n  const text = await resp.text();\n  $block.innerHTML = text;\n}\n\nexport function hydrate() {\n  \n}\n\nexport function createTag(name, attrs) {\n  const el = document.createElement(name);\n  if (typeof attrs === 'object') {\n    for (const [key, value] of Object.entries(attrs)) {\n      el.setAttribute(key, value);\n    }\n  }\n  return el;\n}\n\nfunction wrapSections(element) {\n  document.querySelectorAll(element).forEach(($div) => {\n    if ($div.childNodes.length === 0 || !$div.firstElementChild) {\n      // remove empty sections\n      $div.remove();\n    } else if (!$div.id) {\n      const $wrapper = createTag('div', { class: 'section-wrapper' });\n      $div.parentNode.appendChild($wrapper);\n      $wrapper.appendChild($div);\n    }\n  });\n}\n\nfunction decorateFullWidthImage() {\n  document.querySelectorAll('img').forEach(($img) => {\n    const $section = $img.closest('div');\n    if ($section.children.length === 1 || ($section.children.length === 2 && $section.children[1].tagName.startsWith('H'))) {\n      $section.parentNode.classList.add('full-image');\n      $section.parentNode.classList.remove('section-wrapper');\n    }\n  })\n}\n\n/**\n * Loads a CSS file.\n * @param {string} href The path to the CSS file\n */\n export function loadCSS(href) {\n  if (!document.querySelector(`head > link[href=\"${href}\"]`)) {\n    const link = document.createElement('link');\n    link.setAttribute('rel', 'stylesheet');\n    link.setAttribute('href', href);\n    link.onload = () => {\n    };\n    link.onerror = () => {\n    };\n    document.head.appendChild(link);\n  }\n}\n\nfunction loadBlocks() {\n  document.querySelectorAll('main div.section-wrapper > div > .block').forEach(async ($block) => {\n    const blockName = $block.getAttribute('data-block-name');\n    import(`/blocks/${blockName}/${blockName}.js`)\n      .then((mod) => {\n        if (mod.default) {\n          mod.default($block, blockName, document);\n        }\n      })\n      .catch((err) => console.log(`failed to load module for ${blockName}`, err));\n\n    loadCSS(`/blocks/${blockName}/${blockName}.css`);\n  });\n}\n\nfunction decorateBlocks() {\n  document.querySelectorAll('main div.section-wrapper > div > div').forEach(($block) => {\n    const classes = Array.from($block.classList.values());\n    let blockName = classes[0];\n    const $section = $block.closest('.section-wrapper');\n    if ($section) {\n      $section.classList.add(`${blockName}-container`.replace(/--/g, '-'));\n    }\n    const blocksWithOptions = [];\n    blocksWithOptions.forEach((b) => {\n      if (blockName.startsWith(`${b}-`)) {\n        const options = blockName.substring(b.length + 1).split('-').filter((opt) => !!opt);\n        blockName = b;\n        $block.classList.add(b);\n        $block.classList.add(...options);\n      }\n    });\n    $block.classList.add('block');\n    $block.setAttribute('data-block-name', blockName);\n  });\n}\n\nfunction loadHeader() {\n\n}\n\nasync function decoratePage() {\n  wrapSections('main > div');\n  loadHeader();\n  decorateFullWidthImage();\n  decorateBlocks();\n  const $img = document.querySelector('main img');\n  if ($img) {\n    if ($img.complete) {\n      loadLater();\n    } else {\n      $img.addEventListener('load', () => {\n        loadLater();\n      })\n      $img.addEventListener('error', () => {\n        loadLater();\n      })\n    }\n  } else {\n    loadLater();\n  }\n  document.querySelector('main').classList.add('appear');\n}\n\nfunction loadLater() {\n  document.body.classList.add('appear');\n  loadBlocks();\n  loadCSS('/lazy-style.css');\n}\n\ndecoratePage();"],"file":"scripts.dev.js"}